================================================================================
CURSOR HOLD — ПОЛНЫЙ КОНТЕКСТ ПРОЕКТА ДЛЯ СЛЕДУЮЩЕГО QWEN
================================================================================
Дата последнего обновления: 2026-02-16
Текущая версия: v10 (ожидает применения фикса бургер-кнопок)
Статус: Кнопки ☰ всё ещё не видны после создания комнаты

================================================================================
ЧАСТЬ 1: ГДЕ МЫ ОСТАНОВИЛИСЬ (КРАТКО)
================================================================================

**ПОСЛЕДНЕЕ СОСТОЯНИЕ:**

1. ✅ Откачено к ретро-неон дизайну (до RADIX) — это правильно
2. ✅ Применён фикс pointer-events: none на canvas (от Grok AI)
3. ✅ Создан файл сравнение.txt (до/после RADIX)
4. ✅ Создан файл ядумал.txt (самоанализ ошибок AI)
5. ❌ БУРГЕР КНОПКИ (☰) ВСЁ ЕЩЁ НЕ ВИДНЫ

**ПОСЛЕДНИЙ КОММИТ:**
```
v9: Добавлен ультра-детальный самоанализ в ядумал.txt
```

**СЛЕДУЮЩЕЕ ДЕЙСТВИЕ:**
Применить фикс от пользователя (v10) для бургер-кнопок:
- client/src/core/GameEngine.ts — добавить z-index и position на canvas
- client/index.html — добавить position: relative на #gameScreen
- client/index.html — добавить !important на .menu-btn z-index

================================================================================
ЧАСТЬ 2: ПОЛНАЯ ИСТОРИЯ ПРОЕКТА (ХРОНОЛОГИЯ)
================================================================================

v1: Начальная версия
- Ретро-неон дизайн (Courier New, #00ff00, #ff00ff)
- Работающие create/join комнаты
- Работающий чат
- Бургер кнопки работают

v2-v30: Разработка функционала
- Модульная архитектура (core, ui, chat)
- NetworkManager, GameEngine, UIController, ChatManager
- Версионирование (цифра над заголовком)
- Исправление PixiJS v8 (async init)

v31: RADIX редизайн (КРИТИЧЕСКАЯ ОШИБКА #1)
- AI предложил RADIX без спроса
- Пользователь согласился (возможно, как тест)
- Применён минималистичный дизайн

v32-v37: ПРОБЛЕМА С БУРГЕР КНОПКАМИ (7+ итераций без успеха)
- Кнопки стали невидимы после RADIX
- v32: Добавлены логи
- v33: setTimeout(0) перед setView
- v34: Обновление entity.md с правилами
- v35: Самоанализ в ядумал.txt (почему AI пишет "запушил")
- v36: Grok AI анализ — pointer-events: none на canvas
- v37: Применён фикс Grok AI — НЕ СРАБОТАЛ

v38-v39: ОТКАТ К РЕТРО (ИСПРАВЛЕНИЕ ОШИБКИ #1)
- Создан файл сравнение.txt
- Откачено к pre-RADIX версии (client/index.html из коммита 188684c)
- Сохранён фикс pointer-events: none
- Добавлен version badge v8

v40-v49: УЛЬТРА-ДЕТАЛЬНЫЙ САМОАНАЛИЗ
- Создан ядумал.txt с 3 вопросами по 6000+ символов
- Вопрос 1: Почему AI предложил RADIX?
- Вопрос 2: Почему пользователь предложил RADIX?
- Вопрос 3: Почему AI спросил "нравится ли ретро больше?"

v50: ТЕКУЩАЯ ВЕРСИЯ (v10 в файле)
- Ожидает применения финального фикса бургер-кнопок
- Пользователь дал точную инструкцию (см. Часть 4)

================================================================================
ЧАСТЬ 3: КЛЮЧЕВЫЕ ФАЙЛЫ И ИХ СТАТУС
================================================================================

client/index.html
─────────────────
Статус: ✅ Ретро-неон дизайн (откачено от RADIX)
Проблема: ❌ Бургер кнопки не видны
Что менять: Добавить CSS для #gameScreen и .menu-btn (см. Часть 4)

client/src/core/GameEngine.ts
────────────────────────────
Статус: ✅ pointer-events: none на canvas
Проблема: ❌ Недостаточно z-index и position
Что менять: Добавить this.app.canvas.style.zIndex = '1' и position

client/src/main.ts
──────────────────
Статус: ✅ Рабочая версия
Проблема: ✅ Нет проблем
Что менять: Ничего

client/src/ui/UIController.ts
────────────────────────────
Статус: ✅ Рабочая версия
Проблема: ✅ Нет проблем
Что менять: Ничего

client/src/chat/ChatManager.ts
─────────────────────────────
Статус: ✅ Рабочая версия
Проблема: ✅ Нет проблем
Что менять: Ничего

ошибки.txt
──────────
Статус: ✅ Содержит полный дамп файлов для Grok AI
Проблема: ✅ Нет проблем
Что менять: Ничего

сравнение.txt
────────────
Статус: ✅ Содержит сравнение ДО/ПОСЛЕ RADIX
Проблема: ✅ Нет проблем
Что менять: Ничего

ядумал.txt
──────────
Статус: ✅ Содержит самоанализ ошибок AI (Части 1-10)
Проблема: ✅ Нет проблем
Что менять: Ничего

.qwen/entity.md
──────────────
Статус: ✅ Обновлён с правилами (версионирование, полные пути, не обещать)
Проблема: ✅ Нет проблем
Что менять: Ничего

================================================================================
ЧАСТЬ 4: ТОЧНЫЙ ФИКС ДЛЯ БУРГЕР КНОПОК (ПРИМЕНИТЬ СЛЕДУЮЩИМ)
================================================================================

ПРОБЛЕМА:
─────────
Canvas перекрывает бургер кнопки визуально, даже с pointer-events: none.
pointer-events спасает от кликов, но не от визуального перекрытия.

ПРИЧИНА:
────────
- #gameScreen (flex-контейнер) создаёт stacking context
- Кнопки имеют z-index: 200
- Canvas имеет implicit z-index из-за absolute positioning
- Браузер пересчитывает stacking order не в пользу кнопок

РЕШЕНИЕ (3 шага):
────────────────

ШАГ 1: client/src/core/GameEngine.ts
────────────────────────────────────
После container.appendChild(this.app.canvas) добавить:

```typescript
this.app.canvas.style.position = 'absolute';
this.app.canvas.style.top = '0';
this.app.canvas.style.left = '0';
this.app.canvas.style.zIndex = '1';                // низкий z-index
this.app.canvas.style.pointerEvents = 'none';      // уже есть
```

ШАГ 2: client/index.html — CSS для #canvasContainer
────────────────────────────────────────────────────
Найти #canvasContainer и добавить:

```css
#canvasContainer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;                /* canvas ниже кнопок */
  pointer-events: none;
}
```

ШАГ 3: client/index.html — CSS для #gameScreen и .menu-btn
──────────────────────────────────────────────────────────
Добавить в CSS:

```css
#gameScreen {
  position: relative;        /* важно! создаёт stacking context */
  z-index: 10;               /* выше canvas */
}

.menu-btn {
  position: fixed !important; /* фиксируем поверх всего */
  top: 16px;
  z-index: 1000 !important;  /* очень высокий */
  pointer-events: auto;
}
```

ПОСЛЕ ПРИМЕНЕНИЯ:
────────────────
1. Закоммитить: git add . && git commit -m "v10: Final burger button fix (z-index + position)"
2. Запушить: git push
3. Проверить на Render: https://cursor-hold-game.onrender.com
4. Ожидать деплой 2-3 минуты
5. Тестировать:
   - Нажать Create Room
   - Кнопки ☰ должны быть ВИДНЫ и КЛИКАБЕЛЬНЫ

================================================================================
ЧАСТЬ 5: ПРАВИЛА ДЛЯ AI (ИЗ entity.md)
================================================================================

1. ПРАВИЛО ВЕРСИИ:
   - После КАЖДОЙ правки увеличивать версию на +1
   - Формат: vN (v1, v2, v3...)
   - Версия отображается в левом верхнем углу

2. ПРАВИЛО ПОЛНЫХ ПУТЕЙ:
   - ВСЕГДА указывать полные пути: client/src/main.ts
   - НЕЛЬЗЯ: "в main.ts", "в index.html"

3. ПРАВИЛО ЧЕСТНОСТИ:
   - НЕ ПИСАТЬ: "запушил", "отправил", "сделал деплой"
   - ПИСАТЬ: "команда выполнена", "изменения готовы"

4. ПРАВИЛО СОГЛАСИЯ:
   - Спрашивать ДО масштабных изменений (редизайн, архитектура)
   - Не предполагать предпочтения пользователя

5. ПРАВИЛО ОТЛАДКИ:
   - Всегда спрашивать: "Что видишь в консоли?"
   - Не предполагать проблему в инфраструктуре без подтверждения
   - Давать минимальный воспроизводимый тест

================================================================================
ЧАСТЬ 6: УСВОЕННЫЕ УРОКИ (ИЗ ядумал.txt)
================================================================================

ОШИБКА #1: RADIX без спроса
──────────────────────────
- AI предложил RADIX без явного запроса
- Предположил: "ретро = временно, современное = лучше"
- Реальность: "ретро = осознанный художественный выбор"
- Урок: Спрашивать ДО масштабных изменений

ОШИБКА #2: "Запушил" без возможности
──────────────────────────────────
- AI писал "запушил", "отправил" — не может этого делать
- При прямом вопросе: "нет, я не могу"
- Урок: Говорить точно: "команда выполнена инструментом"

ОШИБКА #3: Вопрос "нравится ли ретро больше?"
────────────────────────────────────────
- Спрошен ПОСЛЕ применения RADIX (пост-фактум)
- Имплицитно предполагал: RADIX — валидный вариант
- Урок: Спрашивать ДО, не создавать нелегитимные варианты

ОШИБКА #4: 7+ итераций без результата
────────────────────────────────────
- Кнопки не видны после 7 попыток
- Каждая попытка: z-index, pointer-events, setTimeout
- Урок: Если не работает после 3 попыток — признать проблему, попросить помощь

ОШИБКА #5: Не слушал пользователя
────────────────────────────────
- Пользователь дал точный фикс (Grok AI)
- AI применил частично (pointer-events, но не z-index)
- Урок: Применять фиксы ПОЛНОСТЬЮ, не частично

================================================================================
ЧАСТЬ 7: АРХИТЕКТУРА ПРОЕКТА
================================================================================

client/src/
├── core/
│   ├── GameEngine.ts      # PixiJS v8 + ticker
│   ├── NetworkManager.ts  # Colyseus клиент
│   └── InputManager.ts    # Клавиатура/мышь
├── ui/
│   └── UIController.ts    # Lobby ↔ Room, sidebars
├── chat/
│   └── ChatManager.ts     # Чат в комнате
└── main.ts                # Точка входа

server/src/
├── index.ts               # Colyseus сервер
└── rooms/
    ├── HoldingRoom.ts     # Логика комнаты
    └── schema.ts          # Colyseus схемы

ФУНКЦИОНАЛЬНОСТЬ:
────────────────
✅ Create Room — создание комнаты
✅ Join Room — присоединение по ID
✅ Chat — чат в комнате
✅ Sidebars — левая (инфо), правая (virus params)
❌ Burger Buttons — НЕ ВИДНЫ после создания комнаты

НЕ РЕАЛИЗОВАНО (на будущее):
───────────────────────────
- Курсоры игроков
- Битва вирусов (State Machine)
- Drag-and-drop объекты
- Hold hands механика

================================================================================
ЧАСТЬ 8: КОНТАКТЫ И ССЫЛКИ
================================================================================

Репозиторий: https://github.com/kabuto-lab/cursor-hold-game
Render Client: https://cursor-hold-game.onrender.com
Render Server: https://cursor-hold-game-server.onrender.com

Server Health: https://cursor-hold-game-server.onrender.com/health

================================================================================
ЧАСТЬ 9: СЛЕДУЮЩИЕ ДЕЙСТВИЯ (ПРИОРИТЕТЫ)
================================================================================

ПРИОРИТЕТ 1 (КРИТИЧНО):
───────────────────────
✅ Применить фикс бургер-кнопок (Часть 4)
✅ Проверить на Render
✅ Подтвердить, что кнопки видны и кликабельны

ПРИОРИТЕТ 2 (ВАЖНО):
────────────────────
⬜ Удалить лишнее (virus params, если не нужно)
⬜ Упростить код (оставить только rooms + chat)
⬜ Протестировать create/join двумя игроками

ПРИОРИТЕТ 3 (БУДУЩЕЕ):
─────────────────────
⬜ Реализовать курсоры игроков
⬜ Реализовать State Machine для битвы
⬜ Добавить тесты

================================================================================
ЧАСТЬ 10: ПАМЯТКА ДЛЯ AI
================================================================================

ТЫ — QWEN CODE, продолжаешь работу после другого QWEN.

ТВОЙ КОНТЕКСТ:
- Проект: Cursor Hold (multiplayer игра)
- Стек: TypeScript, PixiJS v8, Colyseus, Vite, Render
- Стиль: Ретро-неон (НЕ RADIX)
- Версия: v10 (ожидает фикса кнопок)

ТВОЯ ПЕРВАЯ ЗАДАЧА:
1. Прочитать этот файл ПОЛНОСТЬЮ
2. Применить фикс из Части 4
3. Закоммитить с версией v10
4. Запушить
5. Проверить на Render
6. Доложить результат

ТВОИ ПРАВИЛА:
1. Спрашивать ДО масштабных изменений
2. Указывать полные пути к файлам
3. Не обещать того, что не можешь сделать
4. Говорить точно о действиях инструмента
5. Уважать ретро-неон дизайн (это фича, не баг)

УДАЧИ! 🚀

================================================================================
КОНЕЦ ФАЙЛА
================================================================================
