================================================================================
CURSOR HOLD — ИНСТРУКЦИЯ ПО ЗАПУСКУ
================================================================================
Дата: 2026-02-16
Версия: v26 (с курсорами)

================================================================================
ПРОБЛЕМА: "CREATE ROOM" НЕ РАБОТАЕТ
================================================================================

ПРИЧИНА: Клиент пытался подключиться к удалённому серверу (Render), а не к локальному.

РЕШЕНИЕ: NetworkManager теперь автоматически определяет:
  - localhost → ws://localhost:2567
  - production → wss://cursor-hold-game-server.onrender.com

================================================================================
КАК ЗАПУСТИТЬ (ЛОКАЛЬНО)
================================================================================

1. ОТКРЫТЬ ДВЕ КОНСОЛИ

Консоль 1 — сервер:
  cd C:\__Qwen1\TOVCH
  npm run dev:server

Консоль 2 — клиент:
  cd C:\__Qwen1\TOVCH
  npm run dev:client

2. ОТКРЫТЬ БРАУЗЕР
  http://localhost:5173

3. НАЖАТЬ "CREATE ROOM"
  - Должен появиться ID комнаты (например: slHYfNFiu)
  - Если ошибка — проверь, что сервер запущен на порту 2567

4. ОТКРЫТЬ ВТОРОЕ ОКНО (инкогнито)
  http://localhost:5173
  Ввести ID комнаты → "JOIN ROOM"

5. ПРОВЕРИТЬ КУРСОРЫ
  - Двигай мышью в первом окне
  - Во втором окне должен двигаться цветной курсор (круг 15px + стрелка)

================================================================================
ЛОГИ ДЛЯ ДИАГНОСТИКИ
================================================================================

Открыть консоль браузера (F12) и искать:

[NetworkManager] Server URL: ws://localhost:2567
[NetworkManager] createRoom() called
[NetworkManager] Calling client.joinOrCreate("holding_room")...
[NetworkManager] Room created: <ID>
[NetworkManager] setupRoomMessageHandlers called, sessionId: <SESSION>

Если видишь ошибку:
  "Failed to create room: ..." → сервер не запущен или порт неверный

================================================================================
ВОЗМОЖНЫЕ ОШИБКИ И ФИКСЫ
================================================================================

1. "Failed to create room: request failed with status code 404"
   → Сервер не запущен. Запусти: npm run dev:server

2. "Failed to create room: Connection closed"
   → Порт 2567 занят. Проверь: netstat -ano | findstr 2567

3. "WebSocket connection failed"
   → Брандмауэр блокирует. Разреши Node.js доступ.

4. Курсоры не видны
   → Проверь консоль на ошибки 'cursorUpdate'
   → Убедись, что оба клиента в одной комнате

5. "Cannot find module 'colyseus.js'"
   → Запусти: npm install

================================================================================
СТРУКТУРА ФАЙЛОВ (CURSOR FEATURE)
================================================================================

client/src/
├── features/cursor/
│   ├── CursorManager.ts      # Отправка/получение позиций (каждые 33 мс)
│   └── CursorRenderer.ts     # Рендер курсоров (Graphics, lerp-интерполяция)
├── core/
│   ├── NetworkManager.ts     # +sendCursorUpdate(), авто-выбор сервера
│   ├── InputManager.ts       # Мышь (getMousePosition)
│   └── GameEngine.ts         # PixiJS Application
└── main.ts                   # new CursorManager(...), new CursorRenderer(...)

server/src/rooms/
└── HoldingRoom.ts            # onMessage('updateCursor') → broadcast

================================================================================
ВИЗУАЛ КУРСОРА
================================================================================

- Круг: радиус 7.5px (диаметр 15px)
- Стрелка: треугольник 8px
- Цвет: генерируется из playerId (детерминированно)
- Обводка: белая 2px
- Интерполяция: lerp 0.3 (плавное движение)
- Свой курсор: НЕ рендерится (видны только чужие)

================================================================================
КОНЕЦ ФАЙЛА
================================================================================
